{% load vn_currency %}

<!-- Overlay modal: click ngoài sẽ đóng (clears parent detail container) -->
<div class="fixed inset-0 z-50 flex items-center justify-center p-2"
     onclick="if(!event.target.closest('.order-detail-panel')) document.getElementById('global-order-detail').innerHTML='';">
  <div class="absolute inset-0 bg-black/40"></div>

  <div class="relative bg-white rounded-2xl shadow-xl w-11/12 max-w-lg max-h-[90vh] overflow-auto z-10 p-6 order-detail-panel">
    <div class="mb-4 flex justify-between items-center">
      <div>
        <span class="font-semibold">Mã đơn:</span>
        <span class="font-mono font-semibold text-black">#{{ order.id }}</span>
      </div>
      <div>
        <span class="text-sm text-gray-500">Trạng thái:</span> 
        <span class="text-sm
          {% if order.status == 'pending' %} text-yellow-600
          {% elif order.status == 'shipping' %} text-blue-600
          {% elif order.status == 'completed' %} text-green-600
          {% elif order.status == 'cancelled' %} text-red-600
          {% endif %}
        ">
          {{ order.get_status_display }}
        </span>
      </div>
    </div>

    <div class="mb-4">
      <div class="font-semibold mb-2">Thông tin người nhận</div>
      <div class="text-sm">
        <span class="text-gray-500">Người nhận:</span>
        <span class="text-gray-800">
          {% if order.full_name %}{{ order.full_name }}{% endif %}
        </span>
      </div>
      <div class="text-sm">
        <span class="text-gray-500 mt-1">Số điện thoại:</span>
        <span class="text-gray-800">
          {% if order.phone %}{{ order.phone }}{% endif %}
        </span>
      </div>
      <div class="text-sm">
        <span class="text-gray-500 mt-1">Địa chỉ:</span>
        <span class="text-gray-800">
          {% if order.address %}{{ order.address }}{% endif %}
        </span>
      </div>
    </div>

    <div>
      <div class="font-semibold">Sản phẩm</div>
      <ul class="mt-3 space-y-3">
        {% for item in order.items.all %}
        <li class="flex gap-3 items-center">
          <div class="w-16 h-16 rounded-md overflow-hidden bg-gray-50 flex-shrink-0">
            {% if item.product and item.product.image %}
              <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-full h-full object-cover">
            {% endif %}
          </div>
          <div class="flex-1 min-w-0">
            <div class="text-sm font-medium truncate">{{ item.product.name }}</div>
            <div class="text-xs text-gray-500 mt-1">{{ item.price|vnd }} VND x {{ item.quantity }}</div>
          </div>
          <div class="text-sm font-semibold tabular-nums">{{ item.subtotal|vnd }} VND</div>
        </li>
        {% empty %}
        <li class="text-sm text-gray-400">Không có sản phẩm</li>
        {% endfor %}
      </ul>
    </div>

    <div class="mt-4 border-t pt-4 flex justify-between items-center">
      <div class="text-sm text-gray-600">Tổng đơn</div>
      <div class="text-lg font-semibold tabular-nums">{{ order.total_amount|vnd }} VND</div>
    </div>
  </div>
</div>