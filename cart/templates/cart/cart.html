{% extends 'base.html' %}
{% load vn_currency %}

{% block title %}Gi·ªè h√†ng - Luxora{% endblock %}

{% block content %}
<!-- N·∫°p HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<h2 class="text-3xl font-bold mb-10 text-gray-900 text-center" style="margin-top: 1cm;">Gi·ªè h√†ng üõí</h2>
<div class="max-w-7xl mx-auto mt-10 grid grid-cols-1 lg:grid-cols-1 gap-8">
  
  <!-- üßæ C·ªôt tr√°i: danh s√°ch s·∫£n ph·∫©m -->
  <div class="lg:col-span-2 bg-transparent p-8 border border-gray-300 rounded-xl h-full flex flex-col">

    {% if cart.items.exists %}
    <div class="overflow-x-auto">
  <table class="w-full table-fixed border border-gray-300 rounded-lg text-sm align-middle">
    <!-- ‚úÖ Thi·∫øt l·∫≠p kh√¥ng gian s·∫µn cho t·ª´ng c·ªôt -->
    <colgroup>
      <col style="width: 50%;">  <!-- S·∫£n ph·∫©m -->
      <col style="width: 15%;">  <!-- ƒê∆°n gi√° -->
      <col style="width: 20%;">  <!-- S·ªë l∆∞·ª£ng -->
      <col style="width: 15%;">  <!-- S·ªë ti·ªÅn -->
    </colgroup>

    <thead class="bg-gray-100 text-gray-700 font-semibold">
      <tr>
        <th class="py-4 px-4 text-left">S·∫£n ph·∫©m</th>
        <th class="py-4 px-4 text-center">ƒê∆°n gi√°</th>
        <th class="py-4 px-4 text-center">S·ªë l∆∞·ª£ng</th>
        <th class="py-4 px-4 text-right">S·ªë ti·ªÅn</th>
      </tr>
    </thead>

    <tbody class="divide-y divide-gray-200 text-gray-800">
      {% for item in cart.items.all %}
      <tr class="hover:bg-gray-50 transition">
        
        <!-- üß± C·ªôt 1: S·∫£n ph·∫©m -->
        <td class="py-4 px-4 align-top overflow-hidden text-ellipsis whitespace-nowrap">
          <div class="flex items-center gap-4 overflow-hidden">
            {% if item.product.image %}
              <img src="{{ item.product.image.url }}" 
                   alt="{{ item.product.name }}" 
                   class="w-20 h-20 object-cover rounded-md flex-shrink-0 border">
            {% endif %}
            <div class="min-w-0 overflow-hidden">
              <p class="font-semibold text-gray-900 truncate">{{ item.product.name }}</p>
              {% if item.color %}
                <p class="text-sm text-gray-500 truncate">{{ item.color.name }}</p>
              {% endif %}
            </div>
          </div>
        </td>

        <!-- üí∞ C·ªôt 2: ƒê∆°n gi√° -->
        <td class="py-4 px-4 text-center font-medium tabular-nums whitespace-nowrap overflow-hidden text-ellipsis">
          {{ item.product.price|vnd }}
        </td>

        <!-- üî¢ C·ªôt 3: S·ªë l∆∞·ª£ng -->
        <td class="py-4 px-4 text-center">
          <form 
            hx-post="{% url 'cart:update' %}" 
            hx-target="#cart-item-{{ item.id }}"
            hx-trigger="change"
            class="flex flex-col items-center gap-2">
            {% csrf_token %}
            <input type="hidden" name="product" value="{{ item.product.id }}">
            <input 
              type="number" 
              name="qty"
              min="0"
              value="{{ item.quantity }}"
              class="w-12 h-10 border border-gray-300 rounded-lg text-center text-xs focus:outline-none focus:ring focus:ring-gray-200  "
              onchange="if (this.value == 0) location.reload();">
          </form>
          <form method="post" action="{% url 'cart:remove' %}" class="mt-2">
            {% csrf_token %}
            <input type="hidden" name="product" value="{{ item.product.id }}">
            <button type="submit" class="text-xs cursor-pointer font-semibold text-gray-600 hover:text-gray-900 transition duration-200 border-gray-300 border-b-1 hover:border-none">
              Lo·∫°i b·ªè</button>

        </td>

        <!-- üíµ C·ªôt 4: S·ªë ti·ªÅn -->
        <td class="py-4 px-4 text-right font-bold text-red-600 text-lg whitespace-nowrap tabular-nums overflow-hidden text-ellipsis">
          {{ item.subtotal|vnd }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>


    {% else %}
<!-- üõí Gi·ªè h√†ng tr·ªëng -->
<div class="lg:col-span-3 flex flex-col items-center justify-center bg-white border border-gray-200 rounded-2xl shadow-sm py-16 px-6 text-center">
  <div class="grid grid-cols-2 gap-4">
    <div class="bg-indigo-500 h-24 rounded"></div>
    <div class="bg-indigo-500 h-24 rounded"></div>
  </div>


  <p class="text-gray-700 text-xl font-medium mb-6">Gi·ªè h√†ng ƒëang tr·ªëng! H√£y l·∫•p ƒë·∫ßy gi·ªè h√†ng</p>

  <a href="{% url 'products:list' %}"
     class="bg-black hover:opacity-80 text-white text-base px-8 py-4 duration-300 rounded-full cursor-pointer">
     Ti·∫øp t·ª•c mua s·∫Øm
  </a>
  <div class="grid grid-cols-2 gap-4">
  <div class="bg-indigo-500 h-24 rounded"></div>
  <div class="bg-indigo-500 h-24 rounded"></div>
</div>

</div>
{% endif %}

  <!-- üì¶ C·ªôt ph·∫£i: T√≥m t·∫Øt ƒë∆°n h√†ng -->
  {% if cart.items.exists %}
    <h3 class="text-xl font-semibold mb-4 text-gray-900"></h3>

    <div class="flex justify-between text-xl font-semibold mb-4 text-gray-900">
      <span>T·∫°m t√≠nh</span>
      <span class="tabular-nums">{{ cart.total_price|vnd }}</span>
    </div>

    <p class="text-sm font-semibold mb-4 text-gray-500 mb-4">
      ƒê√£ bao g·ªìm thu·∫ø. Ph√≠ v·∫≠n chuy·ªÉn s·∫Ω ƒë∆∞·ª£c t√≠nh khi thanh to√°n.
    </p>

    <textarea placeholder="Ghi ch√∫ ƒë∆°n h√†ng"
      class="w-full border rounded-lg p-3 mb-4 text-sm bg-transparent focus:ring-2 focus:ring-blue-500"></textarea>

    <div class="flex justify-between items-center text-lg font-semibold border-t pt-4 mb-6">
      <span>T·ªïng c·ªông</span>
      <span class="pr-4 tabular-nums">{{ cart.total_price|vnd }}</span>
    </div>

    <a href="{% url 'cart:checkout' %}" 
      class="w-full block text-center bg-black text-white py-3 rounded-full font-semibold hover:opacity-80 transition">
      Thanh to√°n
    </a>


  </div>
  {% endif %}
</div>
{% endblock %}
