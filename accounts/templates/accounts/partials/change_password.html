{% extends "accounts/acc_layout.html" %}
{% block title %}Đổi mật khẩu - Luxora{% endblock %}

{% block acc_content %}
<h2 class="text-2xl font-semibold text-center mb-6">Đổi mật khẩu</h2>

<form method="post" class="space-y-6 max-w-lg mx-auto" novalidate>
  {% csrf_token %}

  {% if messages %}
    {% for m in messages %}
      {% if forloop.last %}
        <div class="text-sm {% if m.tags %}{{ m.tags }}{% endif %}">{{ m }}</div>
      {% endif %}
    {% endfor %}
  {% endif %}

  <div class="space-y-4">
    <div class="relative">
      <label for="id_old_password" class="block text-sm font-medium text-gray-700 mb-1">
        Mật khẩu hiện tại
      </label>
      <div class="relative">
        {{ form.old_password }}
        <button type="button" class="absolute right-4 top-1/2 -translate-y-1/2 text-sm text-gray-600 hover:text-gray-800 toggle-password"
        data-target="id_old_password">Hiện</button>
      </div>
      {% if form.old_password.errors %}
        <p class="text-sm text-red-600 mt-2">{{ form.old_password.errors|striptags }}</p>
      {% endif %}
    </div>

    <div class="relative">
      <label for="id_new_password1" class="block text-sm font-medium text-gray-700 mb-1">
        Mật khẩu mới
      </label>
      <div class="relative">
      {{ form.new_password1 }}
      <button type="button" class="absolute right-4 top-1/2 -translate-y-1/2 text-sm text-gray-600 hover:text-gray-800 toggle-password"
              data-target="id_new_password1">Hiện</button>
    </div>
      {% if form.new_password1.errors %}
        <p class="text-sm text-red-600 mt-2">{{ form.new_password1.errors|striptags }}</p>
      {% endif %}
    </div>

    <div class="relative">
      <label for="id_new_password2" class="block text-sm font-medium text-gray-700 mb-1">
        Xác nhận mật khẩu mới
      </label>
      <div class="relative">
      {{ form.new_password2 }}
      <button type="button" class="absolute right-4 top-1/2 -translate-y-1/2 text-sm text-gray-600 hover:text-gray-800 toggle-password"
              data-target="id_new_password2">Hiện</button>
            </div>
      {% if form.new_password2.errors %}
        <p class="text-sm text-red-600 mt-2">{{ form.new_password2.errors|striptags }}</p>
      {% endif %}
    </div>
  </div>

  <div class="flex gap-3 mt-2">
    <button type="submit" class="flex-1 bg-black text-white py-2 rounded-lg hover:opacity-80 activate:opacity-100 transition">
      Lưu thay đổi
    </button>
    <a href="{% url 'accounts:profile' %}" class="flex-1 text-center border rounded-lg py-2 hover:bg-gray-50">
      Hủy
    </a>
  </div>
</form>

<script>
(function(){
  document.querySelectorAll('.toggle-password').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const input=document.getElementById(btn.dataset.target);
      if(!input)return;
      const show=input.type==='password';
      input.type=show?'text':'password';
      btn.textContent=show?'Ẩn':'Hiện';
    });
  });
})();
</script>
{% endblock %}
