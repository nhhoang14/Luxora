<div class="space-y-3" id="shipping-list">
    {% if addresses %}
    {% for address in addresses %}
    <div id="address-{{ address.id }}" class="p-3 border rounded-lg bg-gray-50 text-sm flex flex-col gap-2">
        <div class="flex justify-between items-start">
            <div>
                <div class="font-medium">
                    {{ address.recipient_name }}
                </div>
                <div class="text-gray-600 text-sm truncate">{{ address.address }}</div>
                <div class="text-gray-500 text-xs">{{ address.phone }}</div>
            </div>

            <div class="flex gap-2 ml-2 items-start">
                {% if not address.is_default %}
                <button hx-post="{% url 'accounts:set_default_address' address.id %}" hx-target="#shipping-list"
                    hx-swap="innerHTML" class="text-xs px-2 py-1 border rounded-md">
                    Đặt làm mặc định
                </button>
                {% else %}
                <span class="ml-2 text-xs px-2 py-1 bg-green-100 text-green-700 rounded">Mặc định</span>
                {% endif %}
                <button hx-get="{% url 'accounts:edit_address' address.id %}" hx-target="#shipping-form"
                    hx-swap="innerHTML" class="text-xs px-2 py-1 border rounded-md">Sửa</button>

                <!-- chuyển từ hx-delete sang hx-post để tránh vấn đề method/CSRF -->
                <button hx-post="{% url 'accounts:delete_address' address.id %}"
                    hx-confirm="Bạn có chắc muốn xóa địa chỉ này?" hx-target="#shipping-list" hx-swap="innerHTML"
                    class="text-xs px-2 py-1 border rounded-md text-red-600">
                    Xóa
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-gray-400 text-sm">Chưa có địa chỉ nào.</p>
    {% endif %}

    {% if addresses|length < 3 %}
    <div class="mt-3" id="shipping-add-btn">
        <button hx-get="{% url 'accounts:add_address' %}" hx-target="#shipping-form" hx-swap="innerHTML"
            class="w-full mt-2 px-3 py-2 rounded-lg border border-gray-200 text-sm hover:bg-gray-50 text-center">
            + Thêm địa chỉ
        </button>
    </div>
    {% endif %}

<div id="shipping-form"></div>
</div>